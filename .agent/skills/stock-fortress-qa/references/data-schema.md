# Stock Fortress — Report API Data Schema

The backend API endpoint `/api/report/{TICKER}` returns a JSON response with the following structure. The report data is generated by the AI model (Gemini with Google Search grounding).

## API Response Wrapper

```json
{
  "report": { ... },   // The full analysis object (schema below)
  "cached": true/false  // Whether served from Redis cache
}
```

## Report Object Schema

```json
{
  "meta": {
    "ticker": "string (uppercase, e.g. 'AAPL')",
    "company_name": "string (full legal name)",
    "sector": "string (e.g. 'Technology / Consumer Electronics')",
    "current_price": "string (e.g. '$232.50')",
    "market_cap": "string (e.g. '$3.5T')",
    "trailing_pe": "string (numeric, e.g. '37.2')",
    "forward_pe": "string (numeric, e.g. '32.1')",
    "fifty_two_week_range": "string (e.g. '$169.21 - $260.10')",
    "avg_volume": "string (e.g. '52.3M')",
    "beta": "string (numeric, e.g. '1.1')",
    "report_date": "string (e.g. 'Feb 13, 2026')",
    "data_freshness_note": "string (e.g. 'Market close Feb 12, 2026')"
  },

  "step_1_know_what_you_own": {
    "one_liner": "string (plain English description, 1 sentence)",
    "how_it_makes_money": "string (2-3 sentences)",
    "key_products_or_services": ["string array"],
    "customer_type": "string",
    "pass_fail": "string ('YES' or 'NO')"
  },

  "step_2_check_the_financials": {
    "latest_quarter": "string (e.g. 'Q1 FY2026')",
    "revenue_latest": "string (e.g. '$124.3B')",
    "revenue_growth_yoy": "string (e.g. '+4%')",
    "revenue_beat_miss": "string ('BEAT' or 'MISS' with detail)",
    "eps_latest": "string (e.g. '$2.18')",
    "eps_beat_miss": "string ('BEAT' or 'MISS' with detail)",
    "net_income_latest": "string (e.g. '$36.3B')",
    "profitable": "boolean",
    "gross_margin": "string (e.g. '46.9%')",
    "operating_margin_trend": "string (e.g. 'Stable', 'Compressing', or longer text)",
    "debt_level": "string ('LOW', 'MODERATE', 'HIGH')",
    "free_cash_flow_latest": "string (e.g. '$30.6B')",
    "cash_position": "string (e.g. '$160B')",
    "financial_health_grade": "string ('A', 'B', 'C', 'D', or 'F')",
    "red_flags": ["string array — each with source/date"],
    "green_flags": ["string array — each with source/date"],
    "revenue_breakdown": [
      {
        "segment": "string (e.g. 'iPhone')",
        "percentage": "number (0-100)",
        "revenue": "string (optional, e.g. '$200B')"
      }
    ]
  },

  "step_2a_earnings_and_guidance_review": {
    "one_time_items": "string (or 'None')",
    "segment_breakdown": "string (sentence-separated performance by segment)",
    "guidance_changes": "string (with [FORWARD-LOOKING] tag)",
    "management_tone": "string (starts with Confident|Cautious|Defensive|Uncertain)",
    "analyst_reaction": "string (mentions real firms, PT changes)",
    "forward_statements_note": "string (disclaimer)"
  },

  "step_3_understand_the_story": {
    "bull_case": "string (substantive paragraph)",
    "base_case": "string",
    "bear_case": "string (substantive paragraph)",
    "macro_overlay": "string",
    "what_must_go_right": ["string array"],
    "what_could_break_the_story": ["string array"],
    "catalyst_timeline": ["string array — events with dates"]
  },

  "step_4_know_the_risks": {
    "top_risks": [
      {
        "risk": "string (risk name)",
        "severity": "string ('LOW' | 'MEDIUM' | 'HIGH' | 'CRITICAL')",
        "likelihood": "string ('LOW' | 'MEDIUM' | 'HIGH')",
        "explanation": "string"
      }
    ],
    "ownership_signals": "string (insider activity, short interest)",
    "regulatory_exposure": "string",
    "concentration_risk": "string"
  },

  "step_5_check_the_competition": {
    "main_competitors": [
      {
        "name": "string (company name)",
        "why_compete": "string",
        "their_advantage": "string"
      }
    ],
    "moat_strength": "string ('NONE' | 'WEAK' | 'MODERATE' | 'STRONG')",
    "moat_explanation": "string"
  },

  "step_6_valuation_reality_check": {
    "current_pe": "string (e.g. '37.2x')",
    "forward_pe": "string (e.g. '32.1x')",
    "sector_or_peer_avg_pe": "string (numeric or descriptive)",
    "price_to_sales": "string (e.g. '8.5x')",
    "ev_ebitda_if_relevant": "string (e.g. '25x')",
    "simple_dcf_implied_value": "string (calculation detail with [ASSUMPTION] tags)",
    "is_it_expensive": "string ('CHEAP' | 'FAIR' | 'EXPENSIVE' | 'SPECULATIVE')",
    "valuation_context": "string (historical context, upside/downside mention)",
    "bear_case_target": "string (e.g. '$180')",
    "base_case_target": "string (e.g. '$230')",
    "bull_case_target": "string (e.g. '$300')"
  },

  "step_7_verdict": {
    "action": "string ('BUY' | 'WATCH' | 'AVOID')",
    "confidence": "string ('LOW' | 'MEDIUM' | 'HIGH')",
    "one_line_reason": "string",
    "what_signal_would_change_this": "string",
    "most_important_metric_to_track": "string",
    "suggested_revisit_date": "string (e.g. 'After next earnings')"
  },

  "investor_gut_check": {
    "question_1": "string (stock-specific self-assessment question)",
    "question_2": "string",
    "question_3": "string",
    "question_4": "string",
    "mindset_reminder": "string (stock-specific warning/advice)",
    "video_analysis": {
      "url": "string (YouTube URL, optional)",
      "title": "string",
      "channel": "string",
      "why_watch": "string"
    }
  }
}
```

## Validation Rules

### Required Fields
All fields in `meta` and all step objects are required. The only optional step is `step_2a_earnings_and_guidance_review` (may be `null`).

### Enum Validations

| Field | Valid Values |
|-------|-------------|
| `pass_fail` | `YES`, `NO` |
| `financial_health_grade` | `A`, `B`, `C`, `D`, `F` |
| `debt_level` | `LOW`, `MODERATE`, `HIGH` |
| `severity` | `LOW`, `MEDIUM`, `HIGH`, `CRITICAL` |
| `likelihood` | `LOW`, `MEDIUM`, `HIGH` |
| `moat_strength` | `NONE`, `WEAK`, `MODERATE`, `STRONG` |
| `is_it_expensive` | `CHEAP`, `FAIR`, `EXPENSIVE`, `SPECULATIVE` |
| `action` | `BUY`, `WATCH`, `AVOID` |
| `confidence` | `LOW`, `MEDIUM`, `HIGH` |

### Numeric String Patterns
- Prices: `$X.XX` or `$X,XXX.XX`
- Percentages: `+X%` or `-X%` or `X.X%`
- Market cap: `$X.XT` or `$X.XB` or `$X.XM`
- Volume: `X.XM` or `X.XB`
- P/E ratios: `X.Xx` (with trailing 'x')

### Consistency Checks
1. `bear_case_target < base_case_target < bull_case_target`
2. 52W range low < current_price < 52W range high (usually, unless just broke out)
3. Revenue breakdown percentages should approximately sum to 100
4. If `profitable: true`, then `net_income_latest` should be positive
5. `action` should logically align with `confidence` and `is_it_expensive`
